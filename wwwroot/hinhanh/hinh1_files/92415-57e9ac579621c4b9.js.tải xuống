"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[92415],{29936:function(e,t,n){n.d(t,{Bp:function(){return r},HI:function(){return s},J_:function(){return a}});var r="web_travel",s="/api/hash",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuIjoid2ViX3RyYXZlbCIsImMiOiJhYjcyOTZmMi0wNDg5LTRiNGQtODVhMi0wOTAwNmNjYjNlMGIiLCJ3IjoiVHJhdmVsLmNvbS52bnxodHRwczovL3RyYXZlbC5jb20udm4iLCJwIjoiVHJhdmVsfFRyYXZlbCIsInUiOiJhYjcyOTZmMi0wNDg5LTRiNGQtODVhMi0wOTAwNmNjYjNlMGJ8NDY5NGM2ODItNDZjNy00Y2M2LWExOTQtOTY4ZWE5NWU5Y2M5IiwiciI6IkFkbWluIiwiZXhwIjoyNTM0MDIyNzU2MDAsImlzcyI6InRyYXZlbC5jb20udm4iLCJhdWQiOiJhYjcyOTZmMi0wNDg5LTRiNGQtODVhMi0wOTAwNmNjYjNlMGIifQ.aX3hZxdsCkV4qr_0l_Z4RsAXfkMY4VBSFIb0VTobVOQ"},24204:function(e,t,n){n.d(t,{B2:function(){return s},Sc:function(){return r}});var r="TOKEN",s="OtaType"},69119:function(e,t,n){n.d(t,{Z:function(){return E}});var r,s=n(2403),a=n(5194),c=n(5853),i=n(1780),o=n(67445),u=n(24204),h=n(27667),l=n(64131),p=n(29936),f=null,d=!1,g=0,v=!1,y=(r=(0,s._)((function(e,t){var n,r,s,y,T,w,m,C;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:if(v)return[2,Promise.reject("Request is blocked.")];if(n=window.location.href,r=function(e){var t,n,r=new Headers(e);r.append("Content-Type","application/json"),r.append("Accept","application/json"),r.append("ClientId",null!==(t="AB7296F2-0489-4B4D-85A2-09006CCB3E0B")?t:""),r.append("Access-Control-Allow-Credentials","true"),r.append("Access-Control-Allow-Origin",null!==(n="https://api2.travel.com.vn")?n:"");var s=(0,h.SN)("accountSecret");return null!==s&&""!==s&&r.append("SecretKey",s),r}(null==t?void 0:t.headers),r.set("client-url",n),(s=(0,h.SN)("accountSecret"))&&r.set("secretKey",s),y=l.Z.get("NEXT_LOCALE"),r.set("Accept-Language",null!=y?y:"vi"),!r.has("Authorization")){if(r.set("Authorization","Bearer ".concat(p.J_)),(0,h.Zc)(u.Sc,p.J_),!p.J_)return v=!0,[2,Promise.reject("Failed to retrieve token.")];r.set("Authorization","Bearer ".concat(p.J_))}c.label=1;case 1:return c.trys.push([1,3,,4]),[4,fetch(e,(0,i._)((0,a._)({},t),{headers:r}))];case 2:return T=c.sent(),[3,4];case 3:return c.sent(),[2,new Response(JSON.stringify({message:"Không thể kết nối đến máy chủ."}),{status:503,statusText:"Service Unavailable"})];case 4:return 401!==T.status?[3,6]:2!==++g||v?(d||(d=!0,f=(0,o.LP)().then((function(){d=!1,g++}))),[4,f]):(alert("Chúng tôi đang gặp một chút thử thách nhỏ. Mong Quý khách thông cảm và thử lại sau!"),l.Z.remove(u.Sc),(0,h.vr)(u.Sc),v=!0,[2,Promise.reject("Unauthorized request.")]);case 5:return w=c.sent(),(0,h.Zc)(u.Sc,w),w?(r.set("Authorization","Bearer ".concat(w.token)),[2,fetch(e,(0,i._)((0,a._)({},t),{headers:r}))]):[2,Promise.reject("Failed to retrieve token.")];case 6:if(g=0,T.ok)return[3,14];m=null,c.label=7;case 7:return c.trys.push([7,12,,13]),(C=T.headers.get("content-type"))&&C.includes("application/json")?[4,T.json()]:[3,9];case 8:return m=c.sent(),[3,11];case 9:return[4,T.text()];case 10:m=c.sent(),c.label=11;case 11:return[3,13];case 12:return c.sent(),m={message:"Không thể đọc dữ liệu phản hồi từ máy chủ."},[3,13];case 13:return[2,new Response(JSON.stringify(m),{status:T.status,statusText:T.statusText})];case 14:return[2,T]}}))})),function(e,t){return r.apply(this,arguments)}),T=y,w=n(33583),m=n(46315),C=n(87301),b=function(){var e=(0,s._)((function(e,t){var n,r,s,o,u,h;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return[4,j(null==t?void 0:t.headers)];case 1:(n=c.sent()).set("Authorization","Bearer ".concat(p.J_)),c.label=2;case 2:return c.trys.push([2,4,,5]),[4,(0,C.Kd)()];case 3:return r=c.sent(),n.set("Accept-Language","".concat(null!=r?r:"vi")),[3,5];case 4:return c.sent(),n.set("Accept-Language","vi"),[3,5];case 5:s=(0,i._)((0,a._)({next:{revalidate:120,tags:[e.toString()]}},t),{headers:n}),c.label=6;case 6:return c.trys.push([6,11,,12]),[4,fetch(e,s)];case 7:return(o=c.sent()).ok?[3,9]:[4,o.json()];case 8:c.sent(),u=Array.from(o.headers.entries());try{u.reduce((function(e,t){var n=(0,w._)(t,2),r=n[0],s=n[1];return e[r]=s,e}),{})}catch(e){}throw new Error("HTTP error! status: ".concat(o.status));case 9:return[4,o.json()];case 10:return[2,c.sent()];case 11:throw h=c.sent(),(0,m.revalidateTag)(e.toString()),h;case 12:return[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),_=b,j=function(){var e=(0,s._)((function(e){var t,n,r;return(0,c.Jh)(this,(function(s){return(t=new Headers(e)).append("Content-Type","application/json"),t.append("Accept","application/json"),t.has("Accept-Language")||t.append("Accept-Language","vi-VN"),t.append("ClientId",null!==(n="AB7296F2-0489-4B4D-85A2-09006CCB3E0B")?n:""),t.append("Access-Control-Allow-Credentials","true"),t.append("Access-Control-Allow-Origin",null!==(r="https://api2.travel.com.vn")?r:""),[2,t]}))}));return function(t){return e.apply(this,arguments)}}(),N=n(25566),J=null,O=600,A={get:function(e,t){return(0,s._)((function(){var n,r,s;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return n=!1,e=I(e),[4,n?_(e,{method:"GET",signal:J}):T(e,{method:"GET",headers:(0,a._)({"Content-Type":"application/json"},t),signal:J})];case 1:if(!(r=c.sent()))throw new Error("HTTP error!: ".concat(r));return n?(s=r,[3,4]):[3,2];case 2:return[4,r.json()];case 3:s=c.sent(),c.label=4;case 4:return[2,s]}}))}))()},getWithCache:function(e,t,n,r){return(0,s._)((function(){var s,i,o;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return e=r&&r?S(e):I(e),[4,(s=!1)?_(e,{method:"GET",signal:J,next:{revalidate:n||O}}):T(e,{method:"GET",headers:(0,a._)({"Content-Type":"application/json"},t),signal:J,next:{revalidate:n||O}})];case 1:if(!(i=c.sent()))throw new Error("HTTP error!: ".concat(i));return s?(o=i,[3,4]):[3,2];case 2:return[4,i.json()];case 3:o=c.sent(),c.label=4;case 4:return[2,o]}}))}))()},post:function(e,t,n){return(0,s._)((function(){var r,s,i;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return r=!1,e=I(e),[4,r?_(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:J}):T(e,{method:"POST",headers:(0,a._)({"Content-Type":"application/json"},n),body:JSON.stringify(t),signal:J})];case 1:if(!(s=c.sent()))throw new Error("HTTP error!: ".concat(s));return r?(i=s,[3,4]):[3,2];case 2:return[4,s.json()];case 3:i=c.sent(),c.label=4;case 4:return[2,i]}}))}))()},postWithCache:function(e,t,n,r){return(0,s._)((function(){var s,i,o;return(0,c.Jh)(this,(function(c){switch(c.label){case 0:return s=!1,e=I(e),[4,s?_(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:J,next:{revalidate:r||O}}):T(e,{method:"POST",headers:(0,a._)({"Content-Type":"application/json"},n),body:JSON.stringify(t),signal:J,next:{revalidate:r||O}})];case 1:if(!(i=c.sent()))throw new Error("HTTP error!: ".concat(i));return s?(o=i,[3,4]):[3,2];case 2:return[4,i.json()];case 3:o=c.sent(),c.label=4;case 4:return[2,o]}}))}))()}},I=function(e){return(e=e.replace(/\/\//g,"/")).startsWith("/")&&(e=e.substring(1)),"".concat("https://api2.travel.com.vn","/").concat(e)},S=function(e){return(e=e.replace(/\/\//g,"/")).startsWith("/")&&(e=e.substring(1)),"".concat(N.env.NEXT_PUBLIC_SERVER_API_CAR_HOST,"/").concat(e)},E=A},67445:function(e,t,n){n.d(t,{LP:function(){return f},XY:function(){return d}});var r,s=n(2403),a=n(5853),c=n(24204);!function(e){e.success="success",e.not_loggin="notloggin",e.expired="expired"}(r||(r={}));var i,o=n(27667),u=n(69119),h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return Promise.race([fetch(e,t),new Promise((function(e,t){return setTimeout((function(){return t(new Error("Request timed out"))}),n)}))])},l=n(29936),p=n(25566),f=(i=(0,s._)((function(){var e,t,n;function r(){return i.apply(this,arguments)}function i(){return i=(0,s._)((function(){var e;return(0,a.Jh)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,h(l.HI,{method:"POST",headers:{"Content-Type":"application/json"}},5e3)];case 1:if(!(e=t.sent()).ok)throw new Error("Failed to fetch hash");return[4,e.json()];case 2:return[2,t.sent().hash];case 3:return t.sent(),[2,null];case 4:return[2]}}))})),i.apply(this,arguments)}function u(){return p.apply(this,arguments)}function p(){return p=(0,s._)((function(){var e,t,n,s,c=arguments;return(0,a.Jh)(this,(function(a){switch(a.label){case 0:e=c.length>0&&void 0!==c[0]?c[0]:3,t=c.length>1&&void 0!==c[1]?c[1]:1e3,n=1,a.label=1;case 1:return n<=e?[4,r()]:[3,5];case 2:return(s=a.sent())?[2,s]:[4,new Promise((function(e){return setTimeout(e,t)}))];case 3:a.sent(),a.label=4;case 4:return n++,[3,1];case 5:return[2,null]}}))})),p.apply(this,arguments)}return(0,a.Jh)(this,(function(r){switch(r.label){case 0:return[4,u()];case 1:(e=r.sent())||alert("Chúng tôi đang gặp thử thách nhỏ. Mong Quý khách thông cảm và thử lại sau!"),t={method:"POST",headers:{"Content-Type":"application/json",ClientId:"AB7296F2-0489-4B4D-85A2-09006CCB3E0B",Hash:e},body:JSON.stringify({username:l.Bp})},r.label=2;case 2:return r.trys.push([2,5,,6]),[4,fetch("".concat("https://api2.travel.com.vn","/auth/get-token"),t)];case 3:return[4,r.sent().json()];case 4:if(1!==(n=r.sent()).status)throw alert("Chúng tôi đang gặp thử thách nhỏ. Mong Quý khách thông cảm và thử lại sau!"),new Error(n.message);return n.response&&(0,o.Zc)(c.Sc,n.response),[2,n.response];case 5:throw r.sent();case 6:return[2]}}))})),function(){return i.apply(this,arguments)}),d=(function(){var e=(0,s._)((function(e){var t,n;return(0,a.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t={method:"POST",headers:{"Content-Type":"application/json",ClientId:"AB7296F2-0489-4B4D-85A2-09006CCB3E0B"},body:JSON.stringify(e?{accessToken:e.token,refreshToken:e.refreshtoken}:{})},[4,fetch("".concat("https://api2.travel.com.vn","/auth/refresh-token"),t)];case 1:return[4,r.sent().json()];case 2:return 1===(n=r.sent()).status?((0,o.Zc)(c.Sc,n.response),[2,n.response]):[3,4];case 3:return r.sent(),[3,4];case 4:return[4,f()];case 5:return[2,r.sent()]}}))}))}(),function(){var e=(0,s._)((function(e){return(0,a.Jh)(this,(function(t){try{return[2,u.Z.get("/idtravel/get-verify-email?token=".concat(e))]}catch(e){throw e}return[2]}))}));return function(t){return e.apply(this,arguments)}}());p.env.NODE_TLS_REJECT_UNAUTHORIZED="0"}}]);