"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65101],{14443:function(e,n,t){t.d(n,{f:function(){return i}});var i="yyyy-MM-dd"},57034:function(e,n,t){t.d(n,{V:function(){return a}});var i=t(33583),r=t(2265),s=t(68575),a=function(){var e=(0,s.v9)((function(e){return e.sightSeeingService})),n=(0,i._)((0,r.useState)(!0),2),t=n[0],a=n[1];(0,r.useEffect)((function(){e&&a(!1)}),[e]);var o=(0,r.useMemo)((function(){return e.services}),[e]);return{isLoading:t,selectSightSeeing:e,services:o}}},78654:function(e,n,t){t.d(n,{UB:function(){return w},ZP:function(){return Z}});var i=t(5194),r=t(1780),s=t(33583),a=t(57437),o=t(14443),c=t(13853),u=t(7830),l=t(91538),d=t(57034),f=t(60076),v=function(e){var n=e.currentArr,t=e.newSSTicket,s=n.findIndex((function(e){return e.serviceInfo.serviceCode===t.serviceInfo.serviceCode&&e.serviceInfo.dateTimeUsed.from===t.serviceInfo.dateTimeUsed.from}));return-1===s?n=(0,f._)(n).concat([t]):n[s]=(0,r._)((0,i._)({},n[s]),{pickedInfo:t.pickedInfo}),n},h=function(e){var n=e.currentArr,t=e.ssTicketCode,i=n.findIndex((function(e){return e.pickedInfo.serviceCode===t}));return n.splice(i,1),n},p=t(71101),m=t(41935),g=t(90824),S=t(37083),y=t(38886),x=t(2265),b=0,T=0,C=0,N=!1,_=0,j=0,I=x.createContext(void 0);function Z(){var e=(0,x.useContext)(I);if(!e)throw new Error("useSightSeeingCard must be used within a SightSeeingCardProvider");return e}var w=function(e){var n=e.children,t=(0,l.i)(),f=t.removeSighseeingFromCart,Z=t.cartData,w=t.addSighseeingToCart,k=(0,d.V)().selectSightSeeing,E=Z.sightseeing,O=(0,s._)((0,x.useState)(b),2),A=O[0],D=O[1],L=(0,s._)((0,x.useState)(T),2),P=L[0],U=L[1],M=(0,s._)((0,x.useState)(C),2),H=M[0],q=M[1],R=(0,s._)((0,x.useState)(_),2),Q=R[0],G=R[1],F=(0,s._)((0,x.useState)(j),2),V=F[0],B=F[1],K=(0,s._)((0,x.useState)(N),2),W=K[0],$=K[1],z=(0,s._)((0,x.useState)(!1),2),J=z[0],X=z[1],Y=(0,s._)((0,x.useState)(!1),2),ee=Y[0],ne=Y[1],te=(0,s._)((0,x.useState)(!1),2),ie=te[0],re=te[1],se=function(e,n){switch(e){case c.Z.ADULT:D(n);break;case c.Z.CHILD:U(n);break;case c.Z.SENIORS:q(n)}},ae=function(e){var n=e.service;if(se(n.fareInfos[0].passengerType,1),n.fareInfos.length>1){var t=n.fareInfos[0].passengerType;n.fareInfos.map((function(e){e.passengerType!==t&&se(e.passengerType,0)}))}B(1)},oe=function(e){var n=e.service,t=e.date,i=(0,p.j_)(n,A,P,H,t,Q);$(!0),S.h.dispatch((0,g.EZ)({serviceInfo:n,pickedInfo:i}))},ce=function(e){try{S.h.dispatch((0,g.b8)(e.serviceCode)),f(),$(!1),ae({service:e})}catch(e){throw e}},ue=function(e){var n=e.service;X(!0),ae({service:n})},le=function(){X(!1)},de=function(e){var n=e.service;ce(n),X(!1),ne(!1)},fe=function(e){var n=e.service,t=e.calPrice;oe({service:n,date:(0,y.WU)(n.dateTimeUsed.from,o.f)}),G(t),X(!1),ne(!0)},ve=function(e){f(),S.h.dispatch((0,g.b8)(e)),S.h.dispatch((0,m.KO)({}))},he=function(e){me(e),S.h.dispatch((0,g.b8)(e))},pe=function(e){var n,t,s,a,o,c=e.service,l=e.date,d={pickedInfo:(0,p.j_)(c,A,P,H,l,Q),serviceInfo:c},f=E.sightseeing?(0,r._)((0,i._)({},E.sightseeing),{services:v({currentArr:E.sightseeing.services,newSSTicket:d})}):{siteCode:null!==(n=k.siteCode)&&void 0!==n?n:"",siteName:null!==(t=k.siteName)&&void 0!==t?t:"",provider:null!==(s=k.provider)&&void 0!==s?s:{},services:[d],timers:null!==(a=k.timers)&&void 0!==a?a:{},thumbnailUrl:null!==(o=k.thumbnailUrl)&&void 0!==o?o:""};w({id:"",sightseeing:f,type:u.i.SIGHTSEEING})},me=function(e){var n;if(E.sightseeing){var t=null===(n=E.sightseeing)||void 0===n?void 0:n.services;if(t){var s=(0,r._)((0,i._)({},E.sightseeing),{services:h({currentArr:t,ssTicketCode:e})});w({id:"",sightseeing:s,type:u.i.SIGHTSEEING})}}},ge=(0,x.useMemo)((function(){return{noOfAdult:A,setNoOfAdult:D,noOfChild:P,setNoOfChild:U,noOfSenior:H,setNoOfSenior:q,isPicked:W,setIsPicked:$,selectService:oe,removeService:ce,subTotal:Q,setSubTotal:G,totalQty:V,setTotalQty:B,initPax:ae,isChoosing:J,setIsChoosing:X,isConfirmed:ee,setIsConfirmed:ne,isShowSeeDetails:ie,setIsShowSeeDetails:re,handleChoose:ue,handleCancel:le,handleRemove:de,handleConfirm:fe,handleExpired:ve,handleDelete:he,selectSSTicket:pe,removeSSTicket:me}}),[A,P,H,W,Q,J,ee,ie]);return(0,a.jsx)(I.Provider,{value:ge,children:n})}},71101:function(e,n,t){t.d(n,{Hq:function(){return a},hW:function(){return o},j_:function(){return c},qq:function(){return u},rb:function(){return s}});var i=t(33583),r=(t(83255),t(13853)),s=function(e){return e.reduce((function(e,n){return n.providerCode?(e[n.providerCode]||(e[n.providerCode]=[]),e[n.providerCode].push(n),e):e}),{})};function a(e){var n=[],t=new Set;if(0===e.length)return n;var r=!0,s=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done);r=!0){var u=o.value;if(t.has(u.providerName)||(n.push(u.siteName),t.add(u.providerName)),n.length>=8)break}}catch(e){s=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(s)throw a}}var l=new Map;e.forEach((function(e){if(e.siteName){var n=e.siteName.toLowerCase();t.forEach((function(e){var t=new RegExp(e,"gi");n=n.replace(t,"")}));for(var i=(n=(n=n.replace(/công\s*viên/gi,"")).trim().toLowerCase()).split(/\s+/),r=0;r<i.length;r++)for(var s=i[r],a=r+1;a<i.length;a++)s+=" "+i[a],l.has(s)||l.set(s,0),l.set(s,l.get(s)+1)}}));var d=Array.from(l.entries()).filter((function(e){return(0,i._)(e,2)[1]>=2})),f=!0,v=!1,h=void 0;try{for(var p,m=d[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var g=(0,i._)(p.value,1)[0];if(n.length>=8)break;var S=g.split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})).join(" ");n.includes(S)||n.push(S)}}catch(e){v=!0,h=e}finally{try{f||null==m.return||m.return()}finally{if(v)throw h}}var y=new Map;e.forEach((function(e){e.address&&e.address.trim()&&e.address.split(",").map((function(e){return e.trim()})).filter((function(e){return"Việt Nam"!==e})).map((function(e){return e.replace(/\s*\d+$/,"").trim()})).forEach((function(e){y.set(e,(y.get(e)||0)+1)}))}));var x=Array.from(y.entries()).sort((function(e,n){return n[1]!==e[1]?n[1]-e[1]:e[0].localeCompare(n[0])})),b=!0,T=!1,C=void 0;try{for(var N,_=x[Symbol.iterator]();!(b=(N=_.next()).done);b=!0){var j=(0,i._)(N.value,1)[0];if(n.length>=8)break;n.includes(j)||n.push(j)}}catch(e){T=!0,C=e}finally{try{b||null==_.return||_.return()}finally{if(T)throw C}}return n}var o=function(e){var n,t,i,r,s,a=(null===(n=e.get("px"))||void 0===n?void 0:n.split("."))||[];return{providerCode:e.get("pc"),siteCodes:null===(t=e.get("sc"))||void 0===t?void 0:t.split(","),date:e.get("d"),noOfAdult:null!==(i=a[0])&&void 0!==i?i:0,noOfChild:null!==(r=a[1])&&void 0!==r?r:0,noOfSenior:null!==(s=a[2])&&void 0!==s?s:0}},c=function(e,n,t,i,s,a){return{serviceCode:e.serviceCode,date:s,passengers:[{passengerType:r.Z.ADULT,no:n},{passengerType:r.Z.CHILD,no:t},{passengerType:r.Z.SENIORS,no:i}],subTotalPrice:a,dateTimeUsed:e.dateTimeUsed,thumbnail:e.thumbnailUrl}},u=function(e,n){var t=0;return e.fareInfos.forEach((function(e){var i=e.passengerType,r=e.totalPrice,s=n.find((function(e){return e.passengerType===i}));void 0!==s&&(t+=r*s.no)})),t}},65101:function(e,n,t){t.d(n,{D:function(){return S}});var i=t(12249),r=t(57437),s=t(2265),a=t(71495),o=t(61994),c=t(24945),u=t(17458),l=t(79962),d=t(42586),f=t(13853),v=t(52672),h=t(78654),p=t(71070),m=function(e){var n=e.guestType,t=e.description,i=e.quantity,a=e.setQuantity,l=e.max,d=e.min,f=void 0===d?0:d,h=e.minBaseQty,p=e.isAvailable,m=void 0===p||p,g=(0,s.useRef)(null);(0,s.useEffect)((function(){var e=setTimeout((function(){g.current&&g.current.blur()}),0);return function(){return clearTimeout(e)}}),[]);return(0,r.jsx)("div",{className:(0,o.Z)("card_detail",{"not-available":!m}),children:(0,r.jsxs)("div",{className:"card_detail--wrapper",children:[(0,r.jsxs)("div",{className:"card_detail-text",children:[(0,r.jsx)("b",{children:n}),(0,r.jsx)("span",{children:t})]}),(0,r.jsxs)("div",{className:"card_detail-icons",children:[(0,r.jsx)(v.Z,{icon:c.Z,className:"minus-button ".concat(h&&i===h||i===f||!m?"disabled":"enabled"),onClick:function(){i>0&&a((function(e){return e>f?e-1:f}))},disabled:h&&i===h||i===f||!m}),(0,r.jsx)("input",{ref:g,value:i,className:"card_detail--inputQty",type:"number",min:f,max:l,onChange:function(e){var n=Number(e.target.value);n<f||l&&n>l||a(n)}}),(0,r.jsx)(v.Z,{icon:u.Z,className:"minus-button ".concat(i!==l&&m?"enabled":"disabled"),onClick:function(){a((function(e){return e+1}))},disabled:i===l||!m})," "]})]})})},g=function(e){var n=e.guestType,t=e.quantity,i=e.unitPrice;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"total--wrapper",children:[(0,r.jsx)("div",{className:"total-content",children:(0,r.jsx)("span",{children:n})}),(0,r.jsxs)("div",{className:"total-price",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{children:"x"}),(0,r.jsxs)("span",{children:[" ",(0,l.Z)({price:i})]})]})]})})},S=function(e){var n=e.onCancel,t=e.onConfirm,c=e.priceServices,u=e.passengers,v=(0,a.I)("deviceType"),S=new Map(u.map((function(e){return[e.passengerType,e.no]}))),y=new Map(c.map((function(e){return[e.passengerType,e.totalPrice]}))),x=1===c.length,b=(0,h.ZP)(),T=b.noOfAdult,C=b.setNoOfAdult,N=b.noOfChild,_=b.setNoOfChild,j=b.noOfSenior,I=b.setNoOfSenior,Z=b.subTotal,w=b.setSubTotal,k=(0,d.useTranslations)(),E=(0,a.I)("isPortable"),O=(0,s.useMemo)((function(){return E}),[v]),A=y.get(f.Z.ADULT),D=y.get(f.Z.CHILD),L=y.get(f.Z.SENIORS);(0,s.useEffect)((function(){w(T*(null!=A?A:0)+N*(null!=D?D:0)+j*(null!=L?L:0))}),[T,N,j]);var P,U=(0,s.useMemo)((function(){return O?"sightseeing-card-detail-mobile":"sightseeing-card-detail"}),[O]);(0,s.useEffect)((function(){var e,n,t;u.length>0&&(C(null!==(e=S.get(f.Z.ADULT))&&void 0!==e?e:0),_(null!==(n=S.get(f.Z.CHILD))&&void 0!==n?n:0),I(null!==(t=S.get(f.Z.SENIORS))&&void 0!==t?t:0))}),[u]);var M,H=(P={},(0,i._)(P,f.Z.ADULT,T),(0,i._)(P,f.Z.CHILD,N),(0,i._)(P,f.Z.SENIORS,j),P),q=(M={},(0,i._)(M,f.Z.ADULT,C),(0,i._)(M,f.Z.CHILD,_),(0,i._)(M,f.Z.SENIORS,I),M),R=(0,s.useMemo)((function(){return!x&&Object.values(H).every((function(e){return 0===e}))}),[x,H]);return(0,r.jsx)("div",{className:(0,o.Z)("".concat(U),{"animate__animated animate__fadeIn":v===p.w.DESKTOP}),children:(0,r.jsxs)("div",{className:"".concat(U,"--container"),children:[(0,r.jsxs)("div",{className:"left",children:[(0,r.jsxs)("p",{className:"title",children:[k("sightSeeing.selectQuantity"),": "]}),c.map((function(e,n){var t=k("common.".concat(e.passengerType.toLocaleLowerCase())),i=e.passengerType===f.Z.ADULT?k("sightSeeing.overTall"):e.passengerType===f.Z.CHILD?k("sightSeeing.heightFrom"):k("sightSeeing.overOld"),s=H[e.passengerType];return(0,r.jsx)(m,{isAvailable:e.totalPrice>0&&e.availability>0,guestType:t,description:i,quantity:s,setQuantity:q[e.passengerType],min:x?1:0,max:e.availability},n)}))]}),(0,r.jsxs)("div",{className:"right",children:[(0,r.jsxs)("p",{className:"title",children:[k("sightSeeing.summary"),": "]}),(0,r.jsxs)("div",{className:"right_container",children:[(0,r.jsxs)("div",{className:"total",children:[void 0!==A&&0!==T&&(0,r.jsx)(g,{guestType:k("common.adult"),quantity:T,unitPrice:A}),void 0!==D&&0!==N&&(0,r.jsx)(g,{guestType:k("common.child"),quantity:N,unitPrice:D}),void 0!==L&&0!==j&&(0,r.jsx)(g,{guestType:k("common.seniors"),quantity:j,unitPrice:L})]}),(0,r.jsxs)("div",{className:"result",children:[(0,r.jsx)("hr",{}),(0,r.jsxs)("div",{className:"result--wrapper",children:[(0,r.jsx)("div",{className:"result_container",children:(0,r.jsxs)("div",{className:"result_container-content",children:[(0,r.jsxs)("b",{children:[k("common.subTotal"),":"]}),(0,r.jsx)("p",{children:(0,l.Z)({price:Z})})]})}),(0,r.jsx)("div",{className:"result_button",children:(0,r.jsxs)("div",{className:"result_button--wrapper",children:[(0,r.jsx)("div",{className:"result_button-cancel",children:(0,r.jsx)("button",{className:"btn-grey-outline",onClick:n,children:k("common.cancel")})}),(0,r.jsx)("div",{className:"result_button-confirm",children:(0,r.jsx)("button",{className:"btn-book",onClick:function(){t(Z)},disabled:R,children:k("common.confirm")})})]})})]})]})]})]})]})})}}}]);